# import streamlit as st
import pandas as pd
import numpy as np

print("-------------- ê³¼ì œ 2 : ë°ì´í„° í´ë Œì§• --------------")
# íŒŒì¼ì„ ì½ê³ , cp949 ì¸ì½”ë”©
trade_data = pd.read_csv("raw_trade_data.csv", encoding = "cp949")
print(trade_data)

#---------------------------------------------------------------------------------------

# 'ì¤‘ëŸ‰' ì»¬ëŸ¼ì— ê²°ì¸¡ì¹˜ê°€ ìˆë‹¤ë©´ í•´ë‹¹ í’ˆëª©ì˜ í‰ê·  ì¤‘ëŸ‰ìœ¼ë¡œ ì±„ìš°ê¸°
""" 1. í’ˆëª©(HS CODE)ë³„ ì¤‘ëŸ‰ í‰ê·  êµ¬í•˜ê¸° """
hs_mean = trade_data.groupby("hs_code")["ì¤‘ëŸ‰"].mean() # hs_codeë¡œ groupì„ ì¡ê³ , ì¤‘ëŸ‰ì˜ í‰ê· ì„ ë‚´ì¤˜

""" 2. ê²°ì¸¡ì¹˜ë¥¼ ì°¾ì•„ì„œ í•´ë‹¹í•˜ëŠ” groupì˜ ì¤‘ëŸ‰ í‰ê· ìœ¼ë¡œ ì±„ìš°ê¸° """
for hs in hs_mean.index: # index : ë”•ì…”ë„ˆë¦¬ì˜ valueê°’ë§Œ ê°€ì§€ê³  ì˜¤ëŠ” ê²ƒ
    # 1. í˜„ì¬ ìˆœì„œì˜ HS CODEì— í•´ë‹¹í•˜ëŠ” í‰ê· ê°’ ê°€ì ¸ì˜¤ê¸°
    avg_val = hs_mean[hs]
    # 2. ì›ë³¸ ë°ì´í„°ì—ì„œ í•´ë‹¹ HS CODEì´ë©´ì„œ ì¤‘ëŸ‰ì´ ë¹„ì–´ìˆëŠ” í–‰ë§Œ ì°¾ê¸°
    target = (trade_data["hs_code"] == hs) & (trade_data["ì¤‘ëŸ‰"].isna())
    # 3. í•´ë‹¹ë˜ëŠ” ì¹¸ì—ë§Œ í‰ê· ê°’ì„ ëŒ€ì…
    trade_data.loc[target, "ì¤‘ëŸ‰"] = avg_val

    # ë§Œì•½ í•´ë‹¹ HS CODEì˜ í‰ê·  ì¤‘ëŸ‰ì´ ì•„ë‹ˆë¼ 0ìœ¼ë¡œ ì±„ìš°ê³  ì‹¶ë‹¤ë©´?
# trade_data.loc[trade_data["ì¤‘ëŸ‰"].isna()] = 0

#---------------------------------------------------------------------------------------

# 'ìˆ˜ì¶œì…êµ¬ë¶„' ì»¬ëŸ¼ì˜ ë°ì´í„°ê°€ ì˜ë¬¸(Import, Export)ìœ¼ë¡œ ë˜ì–´ ìˆë‹¤ë©´ êµ­ë¬¸(ìˆ˜ì…, ìˆ˜ì¶œ)ìœ¼ë¡œ ì¼ê´„ ë³€ê²½í•˜ê¸°
trade_data.loc[trade_data["ìˆ˜ì¶œì…êµ¬ë¶„"] == "Export", "ìˆ˜ì¶œì…êµ¬ë¶„"] = "ìˆ˜ì¶œ"
trade_data.loc[trade_data["ìˆ˜ì¶œì…êµ¬ë¶„"] == "Import", "ìˆ˜ì¶œì…êµ¬ë¶„"] = "ìˆ˜ì…"

#---------------------------------------------------------------------------------------

# í˜„ì¬ 'ìˆ˜ì¶œê¸ˆì•¡' ë‹¨ìœ„ 'ì›'ì„ 'ë°±ë§Œ ë‹¬ëŸ¬' ë‹¨ìœ„ë¡œ ë³€í™˜í•œ ìˆ˜ì¶œê¸ˆì•¡_M_USD ì»¬ëŸ¼ ë§Œë“¤ê¸° (í™˜ìœ¨ 1,470ì› ê°€ì •)
# ê¸ˆì•¡ Ã· 1470 Ã· 1000000
exchange_rate = 1470
trade_data["ìˆ˜ì¶œê¸ˆì•¡_M_USD"] = (trade_data["ìˆ˜ì¶œê¸ˆì•¡"]/exchange_rate)/1000000

#---------------------------------------------------------------------------------------

# ë³€ê²½ í›„ ë°ì´í„°ì˜ ê° ì»¬ëŸ¼ë³„ ë°ì´í„° íƒ€ì…(df.dtypes)ì„ í™•ì¸í•˜ì—¬ ìˆ˜ì¹˜í˜• ë°ì´í„°ê°€ ë§ëŠ”ì§€ ê²€ì¦
print("\n ---------- [ìµœì¢… ë°ì´í„° í™•ì¸] ----------")
print(trade_data.dtypes)

print("\n ---------- [í´ë Œì§• ê²°ê³¼ ìƒ˜í”Œ í™•ì¸] ----------")
print(trade_data[["ë‚ ì§œ", "hs_code", "ìˆ˜ì¶œì…êµ¬ë¶„", "ì¤‘ëŸ‰", "ìˆ˜ì¶œê¸ˆì•¡_M_USD"]].head(10))

# ìµœì¢… ê²°ê³¼ csv íŒŒì¼ë¡œ ì €ì¥
trade_data.to_csv("./clean_trade_data.csv", index = False)
print("ê³¼ì œ ì™„ë£ŒâœŒï¸ğŸ‘ï¸ğŸ‘„ğŸ‘ï¸âœŒï¸")